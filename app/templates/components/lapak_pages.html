<main id="lapak-pages">
    <div id="lapak-dashboard" class="page container py-4">
      <header class="d-flex justify-content-between align-items-center pb-3 mb-0 border-bottom">
        <div>
          <h4 class="mb-0">Laporan Harian</h4>
          <p class="text-muted mb-0 small"><span id="lapak-name">User</span> | <span id="current-date-lapak"></span></p>
        </div>
        <button class="btn btn-outline-danger btn-sm" onclick="handleLogout()">
          <i class="bi bi-box-arrow-right"></i>
        </button>
      </header>

      <div id="laporan-loading" class="text-center p-5">
        <div class="spinner-border text-primary"></div>
        <p class="mt-2 text-muted">Memuat data...</p>
      </div>

      <div id="laporan-exists" style="display: none" class="mt-4 animate-fade-in">

        <div class="text-center mb-5">
          <div
            class="bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3 shadow-sm"
            style="width: 80px; height: 80px;">
            <i class="bi bi-check-lg" style="font-size: 2.5rem;"></i>
          </div>
          <h4 class="fw-bold text-dark">Laporan Terkirim!</h4>
          <p class="text-muted small px-4">Terima kasih, data penjualan hari ini sudah berhasil masuk ke sistem.</p>
        </div>

        <div class="card shadow-sm border-0 report-card mb-3" onclick="showPage('history-laporan-page')">
          <div class="card-body p-4 d-flex align-items-center">
            <div
              class="bg-primary bg-opacity-10 rounded-circle me-3 text-primary d-flex align-items-center justify-content-center flex-shrink-0"
              style="width: 50px; height: 50px; min-width: 50px; min-height: 50px;">
              <i class="bi bi-clock-history fs-4"></i>
            </div>
            <div>
              <h6 class="fw-bold mb-1 text-primary">Cek Riwayat Laporan</h6>
              <p class="text-muted small mb-0">Lihat status konfirmasi Owner</p>
            </div>
            <i class="bi bi-chevron-right ms-auto text-muted"></i>
          </div>
        </div>

        <div class="card shadow-sm border-0 mb-3" onclick="handleLogout()" style="cursor: pointer;">
          <div class="card-body p-3 d-flex align-items-center justify-content-center text-danger">
            <i class="bi bi-box-arrow-right me-2"></i> Keluar Aplikasi
          </div>
        </div>

      </div>

      <div id="laporan-content" style="display: none">

        <div class="progress-container">
          <div class="d-flex justify-content-between small text-muted mb-2 px-1">
            <span>1. Atur</span>
            <span>2. Isi Stok</span>
            <span>3. Kirim</span>
          </div>
          <div class="progress" style="height: 8px;">
            <div class="progress-bar transition-all" role="progressbar" style="width: 33%;" id="report-progress"></div>
          </div>
        </div>

        <div class="card step-card">
          <div class="card-body p-4">
            <h5 class="card-title fw-bold text-primary mb-3"><i class="bi bi-box-seam-fill me-2"></i>Langkah 1: Atur
              Produk</h5>
            <p class="text-muted small mb-3">Pilih produk apa saja yang dijual hari ini beserta stok awalnya.</p>
            <div class="d-flex gap-2">
              <button class="btn btn-primary flex-grow-1" onclick="openAturProdukModal()">
                <i class="bi bi-plus-lg me-2"></i> Atur Produk
              </button>
              <button class="btn btn-outline-secondary" onclick="showPage('history-laporan-page')">
                <i class="bi bi-clock-history"></i> History
              </button>
            </div>
          </div>
        </div>

        <div class="card step-card">
          <div class="step-header">
            <h5 class="mb-0 text-success fw-bold"><i class="bi bi-pencil-square me-2"></i>Langkah 2: Isi Stok Akhir</h5>
          </div>
          <div class="card-body p-3">
            <div id="product-search-container" class="mb-3" style="display: none;">
              <input type="text" id="main-report-search-input" class="form-control" placeholder="Cari nama produk...">
            </div>

            <div id="report-tables-container">
              <div id="initial-prompt" class="text-center text-muted p-4 border rounded bg-light">
                <i class="bi bi-table" style="font-size: 2rem;"></i>
                <p class="mt-2 mb-0 small">Tabel produk akan muncul di sini setelah Anda menyelesaikan Langkah 1.</p>
              </div>
            </div>

            <div id="report-summary-container" style="display: none;">
              <div id="summary-placeholder"></div>
              <div id="summary-content">
                <span id="summary-total-terjual"></span>
                <span id="summary-total-pendapatan"></span>
                <span id="summary-total-biaya"></span>
                <span id="summary-total-keuntungan"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="card step-card">
          <div class="step-header">
            <h5 class="mb-0 text-info fw-bold"><i class="bi bi-send-check-fill me-2"></i>Langkah 3: Ringkasan & Kirim
            </h5>
          </div>
          <div class="card-body p-4">
            <h6 class="fw-bold mb-3"><i class="bi bi-cash-coin me-2"></i>Input Penjualan Manual</h6>

            <div class="mb-2">
              <label class="form-label small text-muted mb-1">Total QRIS</label>
              <div class="input-group">
                <span class="input-group-text bg-white">Rp</span>
                <input type="text" class="form-control rekap-input" id="rekap-qris" placeholder="0"
                  inputmode="numeric" />
              </div>
            </div>

            <div class="mb-2">
              <label class="form-label small text-muted mb-1">Total Transfer (BCA)</label>
              <div class="input-group">
                <span class="input-group-text bg-white">Rp</span>
                <input type="text" class="form-control rekap-input" id="rekap-bca" placeholder="0"
                  inputmode="numeric" />
              </div>
            </div>

            <div class="mb-4">
              <label class="form-label small text-muted mb-1">Total Uang Tunai (CASH)</label>
              <div class="input-group">
                <span class="input-group-text bg-white">Rp</span>
                <input type="text" class="form-control rekap-input" id="rekap-cash" placeholder="0"
                  inputmode="numeric" />
              </div>
            </div>

            <hr class="border-secondary opacity-25">

            <h6 class="fw-bold mb-3"><i class="bi bi-calculator me-2"></i>Konfirmasi Total</h6>
            <div class="bg-light p-3 rounded mb-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="text-muted small">Total (Sistem):</span>
                <strong id="total-sistem" class="text-dark">Rp 0</strong>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted small">Total (Input Manual):</span>
                <strong id="total-manual" class="text-primary fs-5">Rp 0</strong>
              </div>
            </div>

            <div id="reconciliation-warning" class="alert alert-danger p-2 text-center small mb-3"
              style="display: none;">
              <i class="bi bi-exclamation-triangle-fill me-1"></i> Total manual & sistem tidak sesuai!
            </div>

            <div class="d-grid">
              <button id="kirim-laporan-btn" class="btn btn-secondary btn-lg py-3" disabled>
                <i class="bi bi-lock-fill me-2"></i> Lengkapi Data Dulu
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="history-laporan-page" class="page container py-4">
      <header class="d-flex align-items-center pb-3 mb-4 border-bottom">
        <button class="btn btn-light me-3" onclick="showPage('lapak-dashboard')">
          <i class="bi bi-arrow-left"></i>
        </button>
        <h4 class="mb-0">History Laporan</h4>
      </header>
      <div id="history-loading" class="text-center p-5">
        <div class="spinner-border text-primary"></div>
      </div>
      <div id="history-list" class="list-group"></div>
    </div>
  </main>